## Software Engineering 软件工程

#computer #project

## 做完你的项目

- 大多数软件其实都没有真正完成，作者只是做出了基本功能，然后就发布了。很多软件后来不做了，也不是因为做完了，而是作者放弃了。
- 让我们把程序员比作木匠。你买了一把椅子，因为觉得它能满足你的需求。可是买来以后，每隔几天，木匠就会出现在你的家里，对椅子进行修改。有些变动是你想要的，有些你无所谓，还有一些变动只会让你心生反感。甚至有时候，木匠还会出错，比如木头上伸出了一些尖刺，使椅子不再可用。
- 你买的是椅子，而不是某种千变万化的家具，没人喜欢每天会变的椅子。
- 程序员也是如此，应该对软件有一个总体规划，让它有一个完整的基本功能。虽然以后可以进行维护、错误修复和安全补丁，但基本功能应该从始至终都是完整清晰的。
- 你不能说，因为出现了新情况，所以需要不断改变或完善它的功能。 如果一个软件一直在加功能，它就太大了，超出了你应该做的东西。你试图制造一个超出合理范围的东西，你需要画一下功能图，将过大的软件拆分成几个功能完整且合理的小软件。
- 总之，做完你的项目再发布。用户拿到的，应该是一个基本上做完的项目。

## 软件开发

- 源代码库
  - Google的源代码库为单一源代码库，除了android和Chrome这些工程以及一些关键核心代码其余的所有代码都会存放在这个单一代码库中。
  - 在2015年1月，该代码库大小为86TB，十亿个文件，900万个源代码文件，20亿行源代码，3500万次提交，工作日均4万次变更提交。
  - 代码库是一个树形结构，代码库中的所有代码可以被内部任何人访问、获取、构建及发起变更请求，仅有的限制是需要变更需要该子树的所有者批准，没个子树会有两个所有者，子树会继承父节点的所有权限。
  - 所有代码均采用主干开发，且所有的开发都发生在Head上，而非分支上，以便尽早合入代码、尽早发现集成问题。
  - 会频繁执行自动化测试，一般变更后即可执行，并在几分钟内获得反馈。
  - 还有一个build cop的组织，该组织负责与有问题变更的作者合作，来快速解决问题或撤消变更，从而确保测试持续通过，该组织通常在团队之间或经验丰富的成员之间轮换。
- 构建系统
  - 统一使用名为Blaze的分布式构建系统，其开源版本为bazel，提供用于构建和测试可在整个源码库中可工作软件的标准命令。
  - 构建规范由“构建规则”通过声明式组成
  - 构建产物会缓存在云中，以便加速构建
  - 当启动代码评审或提交变更会触发预提交检查
- 代码评审
  - 基于Web的代码评审工具, 与邮件等通知系统集成。
  - 每个变更至少会有一位评审者，且包括代码所有者，在选择评审人时会自动建议评审人员（根据评审工作量等维度）。
  - 每个代码评审讨论都会自动复制到项目维护者指定的邮件列表中，以便项目相关方查阅。
  - 代码库里有一个“实验”部分，没有执行常规的代码检查要求。
  - 代码评审会鼓励小的变更，会对变更进行大小标记，如：M：33-99，L：300-999，XL：1000-1999
- 测试
  - 以单元测试为基础，同时也对集成测试和回归测试进行广泛的实践，部署之前的负载测试也是如此。
  - 自动统计测试覆盖率，并可与源码一起可视化展示，以便对未覆盖代码重点评审。
  - 测试可以作为代码检查和提交过程的一部分自动执行。
- 缺陷跟踪
  - 使用名为Buganizer系统来进行跟踪，包括：错误，功能请求，客户问题和流程（例如发布或清理工作）。
  - 缺陷被分类为分层组件，每个组件可以具有默认的处理人和CC的默认电子邮件列表。
  - 在缺陷上使用标签来表明是否已对缺陷进行了分类，以及每个缺陷的修复目标是哪个版本。
- 编程语言
  - 官方语言为：C++, Java, Python, Go以及JavaScript，每个语言都有与之对应的《Google代码风格指南》。
  - 定期举办代码可读性培训。
  - 通过Protocol Buffers来实现跨语言通信。
  - 使用相同一组的命令来完成工作，如：检出，编辑，构建，测试，检查 ，提交，文件错误报告等。
- 调试与分析工具
  - 所有服务器都与许多库链接，这些库提供了许多用于调试正在运行的服务器的工具。
- 发布工程
  - 发布大部分有普通工程师完成。
  - 频繁发布：每周或每两周发布是Google所有团队共同的目标，有些团队甚至每天发布。
  - 通常发布是从与最新“绿色”版本的变更号（即所有自动测试通过的最后更改）同步并生成候选版本开始的。
  - 然后通常将其加载到“预发布”服务器上，以供一小组用户（有时只是开发团队）进行进一步的集成测试。
  - 下一步通常是部署到一个或多个正在处理实时生产流量子集的“ canary”服务器。
  - 最后，该版本可以逐步推广到所有数据中心的所有服务器。
- 发布批准
  - 任何对用户可见的更改或重大设计变更的发布，都需要获得实施变更的核心工程团队之外的许多干系人批准。
  - 有一个内部发布批准工具，该工具用于跟踪所需的审核和批准，并确保符合每个产品的已定义发布过程。
- 事后复盘
  - 每当出现严重故障时，都需要相关人员编写事后复盘文档。该文档描述了事件，包括标题，摘要，影响，时间表，根本原因，有效或无效以及行动项。
  - 重点在于问题以及将来如何避免，而不是追究人员责任。
- 频繁重写：大多数产品每隔几年就会被重写。

## 项目管理

- 20%时间：允许工程师将最多20％的时间用于自己感兴趣的任何项目，而无需经理或其他任何人的批准。
- OKR 个人和团队需要明确记录其目标并评估其在实现这些目标方面的进度
  - 团队设定了季度和年度目标，并给出了可衡量的关键结果，这些结果显示了实现这些目标的进度。
- 项目审批 没有明确的项目批准或取消过程。各个级别的经理都对其团队从事的项目负责。
- 公司重组：行政决策会有时决定取消一个大型项目，然后从事该项目的工程师可能不得不在新团队中寻找新项目。

## 人员管理

- 培训类型：新员工通常都有正式的“导师”和“伙伴”，以帮助他们快速上手。通过与经理定期举行会议，团队会议，代码审查，设计审查和非正式程序来进行非正式的指导。培训类型有：
  - 新Google员工（“ Nooglers”）必须参加必修的初始培训课程。
  - 技术人员（SWE和研究科学家）首先要进行“ Codelabs”：有关个别技术的简短在线培训课程以及编码训练。
  - Google为员工提供各种在线和面对面的培训课程。
  - Google还为在外部机构学习提供支持。
- 人员流动
  - 从工作12个月开始，鼓励在公司不同部门之间进行流动。
  - 会有一些轮岗：鼓励跨组织临时任务。
- 绩效考核与奖励
  - 员工会根据自己的绩效获得年度绩效奖金和股权奖励。
  - 有一个非常仔细的晋升过程，涉及到由自己或经理提名，自我评审，同行评审，经理评估，晋升委员会以及潜在上诉委员会。
  - 绩效不佳是通过经理的反馈来处理的，如有必要，还需要绩效改进计划，其中包括制定非常明确的具体绩效目标并评估这些目标的进度。
  - 通过一年两次的反馈调查来评估经理的绩效。

## Book

- 《Software Engineering at Google》 Fergus Henderson

### 《加速：构建和扩展高性能技术组织》

- 大项目的开发效率低？
  - 代码复杂度:不真正理解系统，也就不会感到自己是代码的主人。你会很犹豫要不要重构，过时的代码开始累积，技术债务就这样出现了。长此以往，开发变得越来越不愉快和令人无法满意，最终导致人才流失。后面接手的新人，更难于重构那些遗留下来的代码。
  - 团队原因
    - 交流成本开始指数式上升
    - 保持扁平化管理，也会越来越困难
- 代码解耦：软件解耦，拆分成组件或者模块，防止各个部分紧密地耦合在一起。每个组件和模块，都可以独立开发，通过公开的接口被其它部分调用。
- 团队解耦：可以参考互联网的架构
  - 独立的节点
    - 遵守公开的通信协议。
    - 不需要了解其它节点的内部实现，就可以与之通信。
    - 节点之间不直接共享状态，只通过通信交换数据。
    - 每个节点单独开发和部署。
  - 标准
    - 每个子团队都可以独立运作，不依赖外部人员
    - 子团队内部的运作，不需要被外部知道
    - 子团队之间的协调，应该按照公开的协议和规则，最好能够自动完成，避免私下协商
  - 团队解耦注意点
    - 子团队的人数不宜过多，每个子团队最好不要超过5个人
    - 子团队应该是一个小型的全功能软件开发组织
      - 按照软件的业务功能分组，每组负责一个全流程的软件大功能，设计、编码、测试、部署、支持等人员都在同一组。这样才能做到解耦，以及独立的交付和重构。每组内部使用什么工具、如何实现某个功能，都是自己决定，各组之间不需要共享内部细节，也不依赖别组的工作
    - 大团队应该保障子团队的自主权，按照子团队提供的功能和商业价值，进行资源分配
    - 软件架构师的角色很重要
      - 软件架构师的关注点，不应该是团队使用的工具和技术，而是各种服务与整个系统运行状况之间的协议和通信，保证代码和团队可以正确解耦
    - 代码解耦和团队解耦的关系： 理想情况下，代码解耦与团队解耦保持一致，形成一对一的关系，一个子团队负责一个独立的模块。实际运作中，一个子团队负责几个模块也可以，但是一个模块不能由多个子团队来参与。
    - 通信（模块之间的、子团队之间的）尽量规范化，争取做到过程简单、文档充分，最好有规范的 API，这样无需任何人员交流，就能建立通信

### 《规模：生物，城市和公司的普遍法则》

## 工具

- [CORNERSTONE](https://www.cornerstone365.cn/cooperation.html)
